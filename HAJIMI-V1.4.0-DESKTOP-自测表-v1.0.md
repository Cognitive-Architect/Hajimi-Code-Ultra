# HAJIMI-V1.4.0 Desktop 自测表 v1.0

> **版本**: v1.4.0 (Desktop产品化)  
> **日期**: 2026-02-17  
> **目标**: 桌面产品化 - Electron封装、七权可视化面板、自动更新

---

## 自测项总览

| 自测项 | 目标 | 分级 | 状态 |
|:---|:---|:---:|:---:|
| DSK-001 | 安装包体积 < 100MB | P0 | ⏳ 待验证 |
| DSK-002 | 冷启动时间 < 3s | P0 | ⏳ 待验证 |
| DSK-003 | 自动更新零中断 | P0 | ⏳ 待验证 |

---

## DSK-001: 安装包体积 < 100MB

### 测试方法

```bash
# 1. 执行打包优化
npm run package:optimize

# 2. 检查ASAR体积
ls -lh dist/app.asar

# 3. 检查安装包体积
ls -lh dist/*.exe dist/*.dmg dist/*.AppImage
```

### 预期结果

- ASAR压缩后体积 < 80MB
- Windows安装包(.exe) < 100MB
- macOS安装包(.dmg) < 100MB
- Linux安装包(.AppImage) < 100MB

### 优化措施

1. ✅ ASAR压缩 (Brotli level 11)
2. ✅ 代码分割 (webpack splitChunks)
3. ✅ 懒加载路由 (React.lazy)
4. ✅ 排除测试文件和source map
5. ✅ 图片资源优化 (sharp压缩)

---

## DSK-002: 冷启动时间 < 3s

### 测试方法

```bash
# 1. 使用性能测试工具
npm run test:cold-start

# 2. 手动计时
# 点击应用图标 -> 窗口完全渲染

# 3. Electron内置计时
electron . --trace-startup
```

### 启动流程分析

```
┌─────────────────────────────────────────┐
│ 启动阶段              目标时间    实际   │
├─────────────────────────────────────────┤
│ 1. 主进程初始化       < 500ms    ___   │
│ 2. 嵌入服务启动       < 800ms    ___   │
│ 3. 窗口创建           < 500ms    ___   │
│ 4. 渲染进程加载       < 800ms    ___   │
│ 5. 初始化完成         < 400ms    ___   │
├─────────────────────────────────────────┤
│ 总计                  < 3000ms   ___   │
└─────────────────────────────────────────┘
```

### 优化措施

1. ✅ 延迟加载非核心模块
2. ✅ 窗口准备就绪后再显示
3. ✅ 预加载脚本优化
4. ✅ Node.js后端并行启动

---

## DSK-003: 自动更新零中断

### 测试方法

```bash
# 1. 构建测试版本
npm run package:win

# 2. 安装旧版本
./dist/Hajimi-Code-Setup-1.3.0.exe

# 3. 部署更新服务器
npm run update-server:start

# 4. 触发更新检查
# 在应用内点击 "检查更新"

# 5. 验证零中断
# - 下载期间应用保持可用
# - 安装时优雅退出
# - 重启后版本正确
```

### 更新流程验证

```
┌─────────────────────────────────────────┐
│ 1. 检查更新                             │
│    - 后台检查，不阻塞UI                │
│    ✅ 通过 / ❌ 失败                    │
├─────────────────────────────────────────┤
│ 2. 下载更新                             │
│    - 增量下载优先                       │
│    - 进度实时显示                       │
│    ✅ 通过 / ❌ 失败                    │
├─────────────────────────────────────────┤
│ 3. 验证完整性                           │
│    - SHA256校验                         │
│    ✅ 通过 / ❌ 失败                    │
├─────────────────────────────────────────┤
│ 4. 安装更新                             │
│    - Windows: 脚本替换                  │
│    - macOS: DMG挂载替换                 │
│    - Linux: AppImage替换                │
│    ✅ 通过 / ❌ 失败                    │
├─────────────────────────────────────────┤
│ 5. 重启应用                             │
│    - 版本号正确                         │
│    - 配置保留                           │
│    ✅ 通过 / ❌ 失败                    │
└─────────────────────────────────────────┘
```

---

## 七权面板功能测试

### 视觉验证

| 项目 | 预期 | 实际 |
|:---|:---|:---|
| 六角星形布局 | 7个节点均匀分布 | ___ |
| 呼吸灯效果 | 状态颜色正确，动画流畅 | ___ |
| 主题切换 | 7个角色主题色正确 | ___ |
| 快捷键响应 | 1-7数字键切换 | ___ |

### 交互验证

| 操作 | 预期结果 | 实际 |
|:---|:---|:---|
| 点击Agent节点 | 切换到该Agent | ___ |
| 鼠标悬停 | 显示快捷键提示 | ___ |
| 离线Agent | 不可点击，灰显 | ___ |
| 负载显示 | 进度条实时更新 | ___ |

---

## Agent状态面板测试

### 性能指标

| 指标 | 预期范围 | 实际 |
|:---|:---|:---|
| CPU使用率 | 0-100% | ___ |
| 内存使用率 | 0-100% | ___ |
| 响应时间 | 0-500ms | ___ |
| 连接数 | 实时更新 | ___ |

### 日志面板

| 功能 | 预期 | 实际 |
|:---|:---|:---|
| 实时滚动 | 最新日志可见 | ___ |
| 自动暂停 | 滚动时暂停 | ___ |
| 日志级别 | 颜色区分正确 | ___ |
| 最大条目 | 保留最近200条 | ___ |

---

## 技术债务声明

| 债务ID | 描述 | 分级 | 清偿计划 |
|:---|:---|:---:|:---|
| DEBT-SIZE-001 | Electron基础包体积 (~50MB) | P1 | 无法避免，使用UPX压缩 |
| DEBT-SIGN-001 | macOS签名和公证需Apple开发者账号 | P2 | 配置GitHub Secrets |
| DEBT-BSDIFF-001 | bsdiff算法可替换为更高效的courgette | P3 | v1.4.1评估 |

---

## 验收确认

| 检查项 | 状态 |
|:---|:---:|
| 8个核心文件已创建 | ✅ |
| 代码符合TypeScript规范 | ✅ |
| 自测项已定义 | ✅ |
| 债务已声明 | ✅ |

**唐音收工确认**: ☝️😋🖥️⚡

*"桌面产品化完成——七权上桌面，启动！"*
