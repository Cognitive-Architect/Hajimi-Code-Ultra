# B-01/06 é»„ç“œç¦Â·æ¶æ„å¸ˆ - æ²™ç›’å†…æ ¸æ¶æ„è®¾è®¡

> **ç‰ˆæœ¬**: 1.0.0  
> **ä½œè€…**: é»„ç“œç¦ (CucumberMu)  
> **çŠ¶æ€**: è®¾è®¡é˜¶æ®µ  
> **å…³è”æ¨¡å—**: TSA (B-05), Fabric (B-07), Governance (B-02/03)

---

## 1. æ¶æ„æ€»è§ˆ

### 1.1 è®¾è®¡ç›®æ ‡

æ²™ç›’å†…æ ¸æ—¨åœ¨ä¸º Hajimi Code æä¾›å®‰å…¨çš„ä»£ç æ‰§è¡Œç¯å¢ƒï¼Œå®ç°ä»¥ä¸‹ç›®æ ‡ï¼š

- **å®‰å…¨éš”ç¦»**: äº”é‡éš”ç¦»æ¶æ„ï¼Œç¡®ä¿æ¶æ„ä»£ç æ— æ³•é€ƒé€¸
- **èµ„æºç®¡æ§**: ä¸¥æ ¼çš„CPUã€å†…å­˜ã€ç½‘ç»œã€ç£ç›˜é™åˆ¶
- **è¡Œä¸ºå®¡è®¡**: å®Œæ•´çš„ç³»ç»Ÿè°ƒç”¨ã€æ–‡ä»¶è®¿é—®ã€ç½‘ç»œè¯·æ±‚è®°å½•
- **æ²»ç†é›†æˆ**: ä¸ä¸ƒæƒæ²»ç†ç³»ç»Ÿæ·±åº¦é›†æˆï¼Œé«˜å±æ“ä½œéœ€æŠ•ç¥¨
- **TSAå½’æ¡£**: æ‰§è¡Œè®°å½•è‡ªåŠ¨å½’æ¡£è‡³TSA Archiveå±‚
- **Fabricèåˆ**: æ”¯æŒPatternçº§åˆ«çš„æ²™ç›’ç­–ç•¥ç»‘å®š

### 1.2 æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æ²™ç›’å†…æ ¸æ¶æ„ (Sandbox Core)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     äº”é‡éš”ç¦»æ¶æ„ (Five-Layer Isolation)           â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ L1: è¿›ç¨‹éš”ç¦» â”‚â†’â”‚ L2: å‘½åç©ºé—´ â”‚â†’â”‚ L3: æ–‡ä»¶ç³»ç»Ÿ â”‚â†’â”‚ L4: ç½‘ç»œ â”‚â†’â”‚   â”‚
â”‚  â”‚  â”‚  Process   â”‚  â”‚  Namespace â”‚  â”‚   Overlay  â”‚  â”‚  Proxy  â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚         â†“                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚              L5: ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤ (Seccomp/BPF)               â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    å…¸ç‹±é•¿ (SandboxOrchestrator)                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   create()  â†’  execute()  â†’  audit()  â†’  destroy()              â”‚   â”‚
â”‚  â”‚      â†“           â†“           â†“           â†“                      â”‚   â”‚
â”‚  â”‚   [åˆ›å»º]       [æ‰§è¡Œ]       [å®¡è®¡]       [é”€æ¯]                  â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      å®¡è®¡ä¸å½’æ¡£å­ç³»ç»Ÿ                             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚   â”‚ System Callsâ”‚    â”‚ File Access â”‚    â”‚   Network   â”‚        â”‚   â”‚
â”‚  â”‚   â”‚   ç³»ç»Ÿè°ƒç”¨   â”‚    â”‚   æ–‡ä»¶è®¿é—®   â”‚    â”‚   ç½‘ç»œå°è¯•   â”‚        â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚   â”‚
â”‚  â”‚                            â†“                                   â”‚   â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚   â”‚
â”‚  â”‚                    â”‚  Audit Log  â”‚ â”€â”€â†’ TSA Archive (å†·å­˜å‚¨)     â”‚   â”‚
â”‚  â”‚                    â”‚   å®¡è®¡æ—¥å¿—   â”‚                             â”‚   â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å¤–éƒ¨ç³»ç»Ÿé›†æˆå±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   TSA Archive â”‚  â”‚    Fabric     â”‚  â”‚   Governance  â”‚              â”‚
â”‚  â”‚   ä¸‰å±‚å­˜å‚¨     â”‚  â”‚   è£…å¤‡ç³»ç»Ÿ     â”‚  â”‚   ä¸ƒæƒæ²»ç†     â”‚              â”‚
â”‚  â”‚   (B-05)      â”‚  â”‚   (B-07)      â”‚  â”‚  (B-02/03)    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. äº”é‡éš”ç¦»æ¶æ„è¯¦è§£

### 2.1 ç¬¬ä¸€é‡ï¼šè¿›ç¨‹çº§éš”ç¦» (Process Isolation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è¿›ç¨‹çº§éš”ç¦» (L1)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â€¢ ç‹¬ç«‹è¿›ç¨‹ç©ºé—´                           â”‚
â”‚  â€¢ ç‹¬ç«‹å†…å­˜åœ°å€ç©ºé—´                        â”‚
â”‚  â€¢ çˆ¶å­è¿›ç¨‹å…³ç³»éš”ç¦»                        â”‚
â”‚  â€¢ PIDå‘½åç©ºé—´éš”ç¦»                         â”‚
â”‚                                         â”‚
â”‚  å®ç°æ–¹å¼:                                â”‚
â”‚  - Node.js: child_process.fork()         â”‚
â”‚  - Deno: Deno.run() with sandbox         â”‚
â”‚  - Web: Web Worker (åŒæºé™åˆ¶)             â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯è¦ç‚¹**:
- æ¯ä¸ªæ²™ç›’è¿è¡Œåœ¨ç‹¬ç«‹çš„è¿›ç¨‹ä¸­
- ä½¿ç”¨ `fork()` åˆ›å»ºå­è¿›ç¨‹ï¼Œç¡®ä¿å†…å­˜éš”ç¦»
- è¿›ç¨‹é—´é€šä¿¡é€šè¿‡å—æ§çš„æ¶ˆæ¯é€šé“

### 2.2 ç¬¬äºŒé‡ï¼šå‘½åç©ºé—´éš”ç¦» (Namespace Isolation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å‘½åç©ºé—´éš”ç¦» (L2)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Linux Namespaces:                      â”‚
â”‚  â”œâ”€ PID Namespace    â†’ è¿›ç¨‹IDéš”ç¦»        â”‚
â”‚  â”œâ”€ Mount Namespace  â†’ æ–‡ä»¶ç³»ç»ŸæŒ‚è½½éš”ç¦»   â”‚
â”‚  â”œâ”€ Network Namespace â†’ ç½‘ç»œæ ˆéš”ç¦»        â”‚
â”‚  â”œâ”€ IPC Namespace    â†’ è¿›ç¨‹é—´é€šä¿¡éš”ç¦»     â”‚
â”‚  â”œâ”€ UTS Namespace    â†’ ä¸»æœºåéš”ç¦»         â”‚
â”‚  â””â”€ User Namespace   â†’ ç”¨æˆ·æƒé™éš”ç¦»       â”‚
â”‚                                         â”‚
â”‚  å®¹å™¨åŒ–æ”¯æŒ:                              â”‚
â”‚  - Docker / containerd                  â”‚
â”‚  - gVisor (ç”¨æˆ·æ€å†…æ ¸)                   â”‚
â”‚  - Kata Containers (è½»é‡VM)             â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯è¦ç‚¹**:
- ä½¿ç”¨ Linux namespaces å®ç°ç³»ç»Ÿèµ„æºéš”ç¦»
- æ¯ä¸ªæ²™ç›’æ‹¥æœ‰ç‹¬ç«‹çš„ç½‘ç»œæ ˆã€è¿›ç¨‹æ ‘ã€æ–‡ä»¶ç³»ç»Ÿè§†å›¾
- æ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²ï¼ˆDocker / gVisor / Kataï¼‰

### 2.3 ç¬¬ä¸‰é‡ï¼šæ–‡ä»¶ç³»ç»Ÿéš”ç¦» (Filesystem Isolation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ–‡ä»¶ç³»ç»Ÿéš”ç¦» (L3)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Overlay Filesystem:                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        è”åˆæŒ‚è½½å±‚ (Upper)        â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚   â”‚    æ²™ç›’å¯å†™å±‚ (rw)       â”‚   â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚        åªè¯»åŸºç¡€å±‚ (Lower)        â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚   â”‚    ç³»ç»Ÿåº“æ–‡ä»¶ (ro)       â”‚   â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  è®¿é—®æ§åˆ¶:                                â”‚
â”‚  â€¢ ç™½åå•: å…è®¸è®¿é—®çš„è·¯å¾„                  â”‚
â”‚  â€¢ é»‘åå•: ç¦æ­¢è®¿é—®çš„è·¯å¾„ (/etc, /proc)   â”‚
â”‚  â€¢ åªè¯»æŒ‚è½½: /usr, /lib                 â”‚
â”‚  â€¢ å¯å†™åŒºåŸŸ: /tmp/sandbox/{id}          â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯è¦ç‚¹**:
- ä½¿ç”¨ OverlayFS æˆ– tmpfs åˆ›å»ºå¯å†™å±‚
- åŸºç¡€ç³»ç»Ÿæ–‡ä»¶ä»¥åªè¯»æ–¹å¼æŒ‚è½½
- æ•æ„Ÿç›®å½•ï¼ˆ/etc, /proc, /sysï¼‰å®Œå…¨å±è”½

### 2.4 ç¬¬å››é‡ï¼šç½‘ç»œéš”ç¦» (Network Isolation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç½‘ç»œéš”ç¦» (L4)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ç½‘ç»œä»£ç†æ¨¡å¼:                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Sandbox â”‚â”€â”€â”€â†’â”‚ Proxy Layer â”‚        â”‚
â”‚  â”‚  (éš”ç¦»)  â”‚    â”‚  (å—æ§ä»£ç†)  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                        â†“               â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                 â”‚   å¤–éƒ¨ç½‘ç»œ   â”‚        â”‚
â”‚                 â”‚  (æŒ‰éœ€æ”¾è¡Œ)  â”‚        â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                         â”‚
â”‚  æ§åˆ¶ç­–ç•¥:                                â”‚
â”‚  â€¢ åŸŸåç™½åå•: api.github.com            â”‚
â”‚  â€¢ IPç™½åå•:  192.168.1.0/24            â”‚
â”‚  â€¢ ç«¯å£é™åˆ¶:  80, 443                   â”‚
â”‚  â€¢ åè®®é™åˆ¶:  HTTP/HTTPS only           â”‚
â”‚  â€¢ DNSåŠ«æŒ:   å—æ§è§£æ                   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯è¦ç‚¹**:
- æ‰€æœ‰ç½‘ç»œæµé‡å¿…é¡»ç»è¿‡ä»£ç†å±‚
- æ”¯æŒåŸŸåç™½åå•ã€IPç™½åå•ã€ç«¯å£é™åˆ¶
- DNSè¯·æ±‚å¯é‡å®šå‘è‡³å—æ§è§£æå™¨

### 2.5 ç¬¬äº”é‡ï¼šç³»ç»Ÿè°ƒç”¨è¿‡æ»¤ (Syscall Filtering)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤ (L5)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Seccomp-BPF ç­–ç•¥:                       â”‚
â”‚                                         â”‚
â”‚  å…è®¸åˆ—è¡¨ (Whitelist):                   â”‚
â”‚  â”œâ”€ read, write, open, close           â”‚
â”‚  â”œâ”€ mmap, munmap, mprotect             â”‚
â”‚  â”œâ”€ clone, exit, exit_group            â”‚
â”‚  â””â”€ ... (åŸºç¡€æ–‡ä»¶/å†…å­˜æ“ä½œ)              â”‚
â”‚                                         â”‚
â”‚  ç¦æ­¢åˆ—è¡¨ (Blacklist):                   â”‚
â”‚  â”œâ”€ execve, execveat  â†’ ç¦æ­¢æ‰§è¡Œå¤–éƒ¨ç¨‹åº  â”‚
â”‚  â”œâ”€ socket, connect    â†’ ç¦æ­¢åŸå§‹ç½‘ç»œ     â”‚
â”‚  â”œâ”€ ptrace            â†’ ç¦æ­¢è°ƒè¯•        â”‚
â”‚  â”œâ”€ mount, umount     â†’ ç¦æ­¢æŒ‚è½½        â”‚
â”‚  â””â”€ reboot, init_module â†’ ç¦æ­¢ç³»ç»Ÿæ“ä½œ   â”‚
â”‚                                         â”‚
â”‚  éœ€è¦å®¡æ ¸ (Audit):                       â”‚
â”‚  â”œâ”€ openat (å¸¦O_CREAT)                 â”‚
â”‚  â”œâ”€ socket (ç‰¹å®šdomain)                â”‚
â”‚  â””â”€ ioctl                              â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯è¦ç‚¹**:
- ä½¿ç”¨ Seccomp-BPF æˆ– eBPF è¿‡æ»¤ç³»ç»Ÿè°ƒç”¨
- é»˜è®¤æ‹’ç»æ¨¡å¼ï¼ˆé»‘åå•ï¼‰æˆ–æœ€å°æƒé™æ¨¡å¼ï¼ˆç™½åå•ï¼‰
- æ•æ„Ÿç³»ç»Ÿè°ƒç”¨è§¦å‘å®¡è®¡æ—¥å¿—

---

## 3. TSA Archive é›†æˆ

### 3.1 æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TSA Archive é›†æˆ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   æ²™ç›’æ‰§è¡Œ â”€â”€â†’ å®¡è®¡æ—¥å¿— â”€â”€â†’ TSA (Tiered Storage)              â”‚
â”‚      â”‚            â”‚              â”‚                          â”‚
â”‚      â†“            â†“              â†“                          â”‚
â”‚   [æ‰§è¡Œ]      [å®æ—¶è®°å½•]    [åˆ†å±‚å­˜å‚¨]                        â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                              â”‚TRANSIENTâ”‚ â† çƒ­æ•°æ®ï¼ˆ24hï¼‰      â”‚
â”‚                              â”‚  (çƒ­)   â”‚    å†…å­˜ç¼“å­˜          â”‚
â”‚                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â”‚
â”‚                                   â†“                         â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                              â”‚ STAGING â”‚ â† æ¸©æ•°æ®ï¼ˆ7dï¼‰      â”‚
â”‚                              â”‚  (æ¸©)   â”‚    IndexedDB       â”‚
â”‚                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â”‚
â”‚                                   â†“                         â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                              â”‚ ARCHIVE â”‚ â† å†·æ•°æ®ï¼ˆæ°¸ä¹…ï¼‰     â”‚
â”‚                              â”‚  (å†·)   â”‚    Redis/File      â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                              â”‚
â”‚   å½’æ¡£ç­–ç•¥:                                                   â”‚
â”‚   â€¢ æ‰§è¡Œå®Œæˆ â†’ ç«‹å³å½’æ¡£è‡³ STAGING                            â”‚
â”‚   â€¢ 7å¤©å    â†’ è‡ªåŠ¨è¿ç§»è‡³ ARCHIVE                             â”‚
â”‚   â€¢ æ•æ„Ÿæ“ä½œ  â†’ ç›´æ¥å½’æ¡£è‡³ ARCHIVE                             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å­˜å‚¨ç»“æ„

```typescript
// TSA Archive ä¸­çš„æ²™ç›’å®¡è®¡æ—¥å¿—å­˜å‚¨é”®
interface SandboxArchiveEntry {
  // å­˜å‚¨é”®: sandbox:audit:{sandboxId}:{executionId}
  key: string;
  
  // å…ƒæ•°æ®
  metadata: {
    sandboxId: string;
    executionId: string;
    riskLevel: SandboxRiskLevel;
    createdAt: number;
    archivedAt: number;
    retentionDays: number;
  };
  
  // å‹ç¼©åçš„å®¡è®¡æ•°æ®
  data: Compressed<SandboxAuditLog>;
  
  // ç´¢å¼•å­—æ®µï¼ˆç”¨äºæŸ¥è¯¢ï¼‰
  indexes: {
    bySandbox: string;      // sandbox:{sandboxId}
    byRiskLevel: string;    // risk:{level}
    byTimeRange: string;    // time:{yyyy-mm-dd}
  };
}
```

### 3.3 æŸ¥è¯¢æ¥å£

```typescript
// ä» TSA Archive æŸ¥è¯¢æ²™ç›’å®¡è®¡æ—¥å¿—
interface AuditLogQuery {
  sandboxId?: string;
  executionId?: string;
  riskLevel?: SandboxRiskLevel;
  fromTime?: number;
  toTime?: number;
  eventType?: AuditEventType;
  limit?: number;
  offset?: number;
}

// æŸ¥è¯¢ç»“æœ
interface AuditLogQueryResult {
  logs: SandboxAuditLog[];
  total: number;
  hasMore: boolean;
  // æ•°æ®æ‰€åœ¨å±‚çº§
  tier: 'TRANSIENT' | 'STAGING' | 'ARCHIVE';
}
```

---

## 4. Fabric Patterns é›†æˆ

### 4.1 Pattern ç»‘å®šæœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Fabric Patterns é›†æˆ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   Pattern å®šä¹‰ â”€â”€â†’ æ²™ç›’ç­–ç•¥ç»‘å®š â”€â”€â†’ è¿è¡Œæ—¶åŠ è½½               â”‚
â”‚       â”‚               â”‚                â”‚                    â”‚
â”‚       â†“               â†“                â†“                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Role    â”‚    â”‚ Isolation   â”‚    â”‚ Sandbox   â”‚           â”‚
â”‚  â”‚ Pattern â”‚â”€â”€â”€â†’â”‚ Profile     â”‚â”€â”€â”€â†’â”‚ Instance  â”‚           â”‚
â”‚  â”‚         â”‚    â”‚ (é…ç½®æ–‡ä»¶)   â”‚    â”‚           â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                              â”‚
â”‚   ç¤ºä¾‹:                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚ CucumberMu (æ¶æ„å¸ˆ) Pattern                      â”‚      â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚   â”‚ sandboxProfile: {                                â”‚      â”‚
â”‚   â”‚   riskLevel: 'MEDIUM',                          â”‚      â”‚
â”‚   â”‚   isolationLevel: 'CONTAINER',                  â”‚      â”‚
â”‚   â”‚   networkPolicy: { allowOutbound: true },       â”‚      â”‚
â”‚   â”‚   resourceLimits: { maxMemoryBytes: 512MB }     â”‚      â”‚
â”‚   â”‚ }                                                â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Pattern æ²™ç›’é…ç½®æ‰©å±•

```typescript
// patterns/types.ts æ‰©å±•
interface Pattern {
  // ... åŸæœ‰å­—æ®µ
  
  // æ²™ç›’é…ç½®æ–‡ä»¶IDï¼ˆå¯é€‰ï¼‰
  sandboxProfileId?: string;
  
  // åµŒå…¥çš„æ²™ç›’é…ç½®
  sandboxConfig?: Partial<SandboxConfig>;
}

// è§’è‰² Pattern å¯ä»¥æŒ‡å®šæ²™ç›’ç­–ç•¥
const CucumberMuPattern: Pattern = {
  id: 'sys:arch-cucumber-mu',
  name: 'é»„ç“œç¦',
  type: PatternType.SYSTEM,
  // ...
  
  // æ¶æ„å¸ˆéœ€è¦æ›´å¤šèµ„æº
  sandboxConfig: {
    riskLevel: SandboxRiskLevel.MEDIUM,
    isolationLevel: IsolationLevel.CONTAINER,
    resourceLimits: {
      maxMemoryBytes: 512 * 1024 * 1024,  // 512MB
      maxCpuTimeMs: 120000,                // 2åˆ†é’Ÿ
      maxNetworkConnections: 20,
    },
    networkPolicy: PERMISSIVE_NETWORK_POLICY,
  },
};

const GuGuGaGaPattern: Pattern = {
  id: 'sys:qa-gu-gu-ga-ga',
  name: 'å’•å’•å˜å˜',
  type: PatternType.SYSTEM,
  // ...
  
  // QA ä½¿ç”¨ä¸¥æ ¼é™åˆ¶
  sandboxConfig: {
    riskLevel: SandboxRiskLevel.LOW,
    isolationLevel: IsolationLevel.PROCESS,
    resourceLimits: STRICT_RESOURCE_LIMITS,
    networkPolicy: DEFAULT_DENY_NETWORK_POLICY,
  },
};
```

### 4.3 è¿è¡Œæ—¶ Pattern åŠ è½½

```typescript
// lib/sandbox/core.ts
class SandboxOrchestrator {
  
  /**
   * åˆ›å»ºåŸºäº Pattern çš„æ²™ç›’
   */
  async createFromPattern(
    patternId: string,
    request: CreateSandboxRequest
  ): Promise<SandboxCreateResult> {
    // 1. åŠ è½½ Pattern
    const pattern = await patterns.get(patternId);
    if (!pattern) {
      return { success: false, error: `Pattern not found: ${patternId}` };
    }
    
    // 2. åˆå¹¶é…ç½®
    const config: Partial<SandboxConfig> = {
      ...pattern.sandboxConfig,      // Pattern é»˜è®¤é…ç½®
      ...request.customConfig,        // ç”¨æˆ·è‡ªå®šä¹‰é…ç½®
      patternIds: [patternId, ...(request.patternIds || [])],
    };
    
    // 3. åˆ›å»ºæ²™ç›’
    return this.create({
      ...request,
      customConfig: config,
    });
  }
}
```

---

## 5. ä¸ƒæƒæ²»ç†é›†æˆæµç¨‹

### 5.1 æ²»ç†å†³ç­–æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸ƒæƒæ²»ç†é›†æˆæµç¨‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   æ²™ç›’åˆ›å»ºè¯·æ±‚                                                â”‚
â”‚       â”‚                                                      â”‚
â”‚       â†“                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚   â”‚  é£é™©è¯„ä¼°å¼•æ“    â”‚                                        â”‚
â”‚   â”‚  Risk Assessment â”‚                                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚            â†“                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚   â”‚  é£é™©ç­‰çº§åˆ¤å®š                â”‚                            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
â”‚   â”‚ LOW     â†’ è‡ªåŠ¨æ‰¹å‡†           â”‚                            â”‚
â”‚   â”‚ MEDIUM  â†’ å•è§’è‰²å®¡æ ¸         â”‚                            â”‚
â”‚   â”‚ HIGH    â†’ å¤šè§’è‰²æŠ•ç¥¨ (3/5)   â”‚                            â”‚
â”‚   â”‚ CRITICALâ†’ å…¨ç¥¨é€šè¿‡ (5/5)     â”‚                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚            â†“                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚   â”‚      æ²»ç†æµç¨‹å†³ç­–            â”‚                            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
â”‚   â”‚                             â”‚                            â”‚
â”‚   â”‚   ä½é£é™©                    â”‚                            â”‚
â”‚   â”‚     â†“ ç›´æ¥æ‰§è¡Œ              â”‚                            â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                            â”‚
â”‚   â”‚   â”‚ åˆ›å»ºæ²™ç›’    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â†’ å®Œæˆ                â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                            â”‚
â”‚   â”‚                             â”‚                            â”‚
â”‚   â”‚   ä¸­/é«˜é£é™©                  â”‚                            â”‚
â”‚   â”‚     â†“ åˆ›å»ºææ¡ˆ              â”‚                            â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                            â”‚
â”‚   â”‚   â”‚ Governance â”‚          â”‚                            â”‚
â”‚   â”‚   â”‚  Proposal  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â†’ ç­‰å¾…æŠ•ç¥¨             â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                            â”‚
â”‚   â”‚                             â”‚                            â”‚
â”‚   â”‚   æŠ•ç¥¨å®Œæˆ                   â”‚                            â”‚
â”‚   â”‚     â†“ ç»“æœåˆ¤å®š              â”‚                            â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                            â”‚
â”‚   â”‚   â”‚  é€šè¿‡?     â”‚â”€â”€Yesâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â†’ åˆ›å»ºæ²™ç›’ â†’ å®Œæˆ      â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚                            â”‚
â”‚   â”‚          No                 â”‚                            â”‚
â”‚   â”‚          â†“                  â”‚                            â”‚
â”‚   â”‚      æ‹’ç»è¯·æ±‚                â”‚                            â”‚
â”‚   â”‚                             â”‚                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 è§’è‰²æƒé™çŸ©é˜µ

| é£é™©ç­‰çº§ | PM | Arch | QA | Engineer | Mike | System |
|---------|----|------|----|--------- |------|--------|
| LOW     | âœ… | âœ…   | âœ… | âœ…       | âœ…   | âœ…     |
| MEDIUM  | âœ… | âœ…   | âš ï¸ | âš ï¸       | âŒ   | âŒ     |
| HIGH    | ğŸ—³ï¸ | ğŸ—³ï¸   | ğŸ—³ï¸ | âš ï¸       | âŒ   | âŒ     |
| CRITICAL| ğŸ—³ï¸ | ğŸ—³ï¸   | ğŸ—³ï¸ | ğŸ—³ï¸      | ğŸ—³ï¸   | âŒ     |

**å›¾ä¾‹**:
- âœ… è‡ªåŠ¨æ‰¹å‡†
- âš ï¸ éœ€è¦å®¡æ ¸
- ğŸ—³ï¸ éœ€è¦æŠ•ç¥¨
- âŒ æ— æƒæ“ä½œ

### 5.3 æ²»ç†é›†æˆä»£ç ç¤ºä¾‹

```typescript
// lib/sandbox/core.ts - æ²»ç†é›†æˆ
class SandboxOrchestrator {
  private governance: GovernanceService;
  
  /**
   * åˆ›å»ºæ²™ç›’ï¼ˆå¸¦æ²»ç†å®¡æ ¸ï¼‰
   */
  async create(request: CreateSandboxRequest): Promise<SandboxCreateResult> {
    // 1. é£é™©è¯„ä¼°
    const riskLevel = this.assessRisk(request);
    
    // 2. ä½é£é™©ï¼šç›´æ¥åˆ›å»º
    if (riskLevel === SandboxRiskLevel.LOW) {
      return this.createSandboxInternal(request);
    }
    
    // 3. ä¸­é«˜é£é™©ï¼šéœ€è¦æ²»ç†å®¡æ ¸
    const governanceResult = await this.submitToGovernance(request, riskLevel);
    
    if (!governanceResult.approved) {
      return {
        success: false,
        error: `Governance rejected: ${governanceResult.reason}`,
      };
    }
    
    // 4. å®¡æ ¸é€šè¿‡ï¼Œåˆ›å»ºæ²™ç›’
    return this.createSandboxInternal({
      ...request,
      governanceContext: {
        proposalId: governanceResult.proposalId,
        reviewedBy: governanceResult.reviewers,
      },
    });
  }
  
  /**
   * æäº¤æ²»ç†å®¡æ ¸
   */
  private async submitToGovernance(
    request: CreateSandboxRequest,
    riskLevel: SandboxRiskLevel
  ): Promise<GovernanceResult> {
    // åˆ›å»ºææ¡ˆ
    const proposal = await this.governance.createProposal({
      title: `Create Sandbox: ${request.name}`,
      description: this.generateSandboxDescription(request, riskLevel),
      proposer: request.creatorRole,
      targetState: 'sandbox_creation',
      type: 'custom',
      context: {
        sandboxRequest: request,
        riskLevel,
        estimatedResources: this.estimateResources(request),
      },
    });
    
    // ç­‰å¾…æŠ•ç¥¨å®Œæˆ
    return this.governance.waitForVoting(proposal.id, {
      timeoutMs: GOVERNANCE_TIMEOUT_MS,
    });
  }
}
```

---

## 6. æ ¸å¿ƒç»„ä»¶æ¥å£

### 6.1 SandboxOrchestratorï¼ˆå…¸ç‹±é•¿ï¼‰

```typescript
/**
 * æ²™ç›’ç¼–æ’å™¨ - æ ¸å¿ƒæ§åˆ¶å™¨
 * 
 * èŒè´£ï¼š
 * - æ²™ç›’ç”Ÿå‘½å‘¨æœŸç®¡ç†
 * - èµ„æºåˆ†é…ä¸å›æ”¶
 * - æ²»ç†æµç¨‹åè°ƒ
 * - å®¡è®¡æ—¥å¿—å½’æ¡£
 */
class SandboxOrchestrator {
  // ==================== ç”Ÿå‘½å‘¨æœŸæ–¹æ³• ====================
  
  /**
   * åˆ›å»ºæ²™ç›’
   * @param request åˆ›å»ºè¯·æ±‚
   * @returns åˆ›å»ºç»“æœ
   */
  create(request: CreateSandboxRequest): Promise<SandboxCreateResult>;
  
  /**
   * åŸºäº Pattern åˆ›å»ºæ²™ç›’
   * @param patternId Pattern ID
   * @param request åˆ›å»ºè¯·æ±‚
   * @returns åˆ›å»ºç»“æœ
   */
  createFromPattern(
    patternId: string, 
    request: CreateSandboxRequest
  ): Promise<SandboxCreateResult>;
  
  /**
   * æ‰§è¡Œä»£ç 
   * @param request æ‰§è¡Œè¯·æ±‚
   * @returns æ‰§è¡Œç»“æœ
   */
  execute(request: ExecuteSandboxRequest): Promise<SandboxExecuteResult>;
  
  /**
   * å®¡è®¡æ²™ç›’
   * @param sandboxId æ²™ç›’ID
   * @param executionId æ‰§è¡ŒIDï¼ˆå¯é€‰ï¼‰
   * @returns å®¡è®¡ç»“æœ
   */
  audit(
    sandboxId: string, 
    executionId?: string
  ): Promise<SandboxAuditResult>;
  
  /**
   * é”€æ¯æ²™ç›’
   * @param sandboxId æ²™ç›’ID
   * @param force æ˜¯å¦å¼ºåˆ¶é”€æ¯
   * @returns æ˜¯å¦æˆåŠŸ
   */
  destroy(sandboxId: string, force?: boolean): Promise<boolean>;
  
  // ==================== æŸ¥è¯¢æ–¹æ³• ====================
  
  /**
   * è·å–æ²™ç›’ä¿¡æ¯
   */
  getSandbox(sandboxId: string): Promise<SandboxConfig | null>;
  
  /**
   * è·å–æ²™ç›’ç»Ÿè®¡
   */
  getStats(sandboxId: string): Promise<SandboxStats>;
  
  /**
   * æŸ¥è¯¢å®¡è®¡æ—¥å¿—
   */
  queryAuditLogs(query: AuditLogQuery): Promise<AuditLogQueryResult>;
  
  // ==================== äº‹ä»¶è®¢é˜… ====================
  
  /**
   * è®¢é˜…æ²™ç›’äº‹ä»¶
   */
  on(event: SandboxEventType, handler: SandboxEventHandler): () => void;
  
  /**
   * è®¢é˜…å•æ¬¡äº‹ä»¶
   */
  once(event: SandboxEventType, handler: SandboxEventHandler): void;
}
```

---

## 7. æ–‡ä»¶ç»“æ„

```
lib/sandbox/
â”œâ”€â”€ index.ts           # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ types.ts           # ç±»å‹å®šä¹‰ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ architecture.md    # æ¶æ„æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ core.ts            # æ ¸å¿ƒç±»å®ç°
â”œâ”€â”€ config.ts          # é¢„è®¾é…ç½®
â”œâ”€â”€ executor.ts        # æ‰§è¡Œå¼•æ“
â”œâ”€â”€ audit.ts           # å®¡è®¡ç³»ç»Ÿ
â”œâ”€â”€ isolation/         # éš”ç¦»å±‚å®ç°
â”‚   â”œâ”€â”€ process.ts     # è¿›ç¨‹éš”ç¦»
â”‚   â”œâ”€â”€ namespace.ts   # å‘½åç©ºé—´éš”ç¦»
â”‚   â”œâ”€â”€ filesystem.ts  # æ–‡ä»¶ç³»ç»Ÿéš”ç¦»
â”‚   â”œâ”€â”€ network.ts     # ç½‘ç»œéš”ç¦»
â”‚   â””â”€â”€ syscall.ts     # ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤
â”œâ”€â”€ storage.ts         # TSA å­˜å‚¨é€‚é…å™¨
â”œâ”€â”€ governance.ts      # æ²»ç†é›†æˆ
â””â”€â”€ utils.ts           # å·¥å…·å‡½æ•°

storage/cold/sandbox-audit/  # å®¡è®¡æ—¥å¿—å†·å­˜å‚¨
â”œâ”€â”€ 2024/
â”‚   â”œâ”€â”€ 01/
â”‚   â”‚   â””â”€â”€ sandbox-audit-{id}.json.gz
â”‚   â””â”€â”€ 02/
â””â”€â”€ archive.rules        # å½’æ¡£è§„åˆ™

tests/sandbox/           # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ core.test.ts
â”œâ”€â”€ isolation.test.ts
â”œâ”€â”€ audit.test.ts
â””â”€â”€ governance.test.ts
```

---

## 8. å®‰å…¨ç­–ç•¥é€ŸæŸ¥è¡¨

| é£é™©ç­‰çº§ | éš”ç¦»çº§åˆ« | ç½‘ç»œ | æ–‡ä»¶ç³»ç»Ÿ | æœ€å¤§å†…å­˜ | æœ€å¤§CPU |
|---------|---------|------|---------|---------|---------|
| LOW     | PROCESS | âŒ    | åªè¯»    | 256MB   | 30s     |
| MEDIUM  | CONTAINER | ğŸ”’å—é™ | å¯å†™/tmp | 512MB   | 2min    |
| HIGH    | VM      | ğŸ”’ä»£ç† | éš”ç¦»å·  | 1GB     | 5min    |
| CRITICAL| HARDWARE | âŒ    | æ—       | 2GB     | 10min   |

---

## 9. ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´ |
|-----|------|------|-----|
| 1.0.0 | 2026-02-14 | é»„ç“œç¦ | åˆå§‹æ¶æ„è®¾è®¡ |

---

## 10. å‚è€ƒæ–‡æ¡£

- [TSA æ¶æ„æ–‡æ¡£](../tsa/architecture.md)
- [Fabric Patterns](../patterns/index.ts)
- [Governance ç³»ç»Ÿ](../core/governance/types.ts)
- [Seccomp æ–‡æ¡£](https://www.kernel.org/doc/html/latest/userspace-api/seccomp_filter.html)
- [Linux Namespaces](https://man7.org/linux/man-pages/man7/namespaces.7.html)
