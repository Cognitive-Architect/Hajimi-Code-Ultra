# Windows Docker Redis ç½‘ç»œè¯Šæ–­æŠ¥å‘Š

**è¯Šæ–­ID**: B-01/06  
**è¯Šæ–­æ—¶é—´**: 2026-02-14  
**è¯Šæ–­ç›®æ ‡**: å®šä½Docker-Windowsç½‘ç»œéš”ç¦»æ ¹å›   
**è¯Šæ–­ç¯å¢ƒ**: Windows + Docker Desktop (WSL2æ¨¡å¼) + Rediså®¹å™¨

---

## 1. æ‰§è¡Œæ‘˜è¦

åœ¨Windows + Docker Desktop (WSL2åç«¯) ç¯å¢ƒä¸‹ï¼Œ**Rediså®¹å™¨å¯é€šè¿‡ localhost/127.0.0.1:6379 ä»Windowså®¿ä¸»æœºè®¿é—®**ï¼Œä½†å®¹å™¨IP (172.17.0.2) å’Œ host.docker.internal å‡å­˜åœ¨è¿æ¥è¶…æ—¶é—®é¢˜ã€‚è¿™æ˜¯ç”±äºWSL2æ¶æ„ä¸‹çš„ç½‘ç»œéš”ç¦»ç‰¹æ€§å¯¼è‡´çš„ã€‚

**æ¨èè¿æ¥URL**: `redis://localhost:6379` æˆ– `redis://127.0.0.1:6379`

---

## 2. ç¯å¢ƒä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| æ“ä½œç³»ç»Ÿ | Windows (PowerShell) |
| Dockerç‰ˆæœ¬ | 29.0.1 |
| Dockeråç«¯æ¨¡å¼ | **WSL2** (ç¡®è®¤: docker-desktopè¿è¡Œä¸­) |
| WSLå†…æ ¸ç‰ˆæœ¬ | 6.6.87.2-microsoft-standard-WSL2 |
| å®¹å™¨åç§° | hajimi-redis |
| å®¹å™¨çŠ¶æ€ | Up 45 minutes |
| å®¹å™¨IPåœ°å€ | 172.17.0.2 |
| å®¹å™¨ç½‘å…³ | 172.17.0.1 |
| ç«¯å£æ˜ å°„ | 0.0.0.0:6379->6379/tcp |
| ç½‘ç»œæ¨¡å¼ | bridge (é»˜è®¤) |
| WSLè™šæ‹Ÿç½‘å¡ | 172.20.32.1 |

---

## 3. è¿é€šæ€§çŸ©é˜µè¡¨

### 3.1 ä»Windowså®¿ä¸»æœºåˆ°Rediså®¹å™¨çš„è¿é€šæ€§

| è¿æ¥åœ°å€ | URLæ ¼å¼ | TCPè¿é€šæ€§ | å»¶è¿Ÿ | å¤‡æ³¨ |
|----------|---------|-----------|------|------|
| **localhost** | `redis://localhost:6379` | âœ… æˆåŠŸ | 28ms | **æ¨è** |
| **127.0.0.1** | `redis://127.0.0.1:6379` | âœ… æˆåŠŸ | 2ms | **æ¨èï¼Œå»¶è¿Ÿæœ€ä½** |
| å®¹å™¨IP (172.17.0.2) | `redis://172.17.0.2:6379` | âŒ è¶…æ—¶ | 5005ms | WSL2ç½‘ç»œéš”ç¦»ï¼Œä¸å¯è®¿é—® |
| host.docker.internal | `redis://host.docker.internal:6379` | âŒ è¶…æ—¶ | 5012ms | DNSè§£æåˆ°192.168.0.208ï¼Œä½†ç«¯å£ä¸å¯è¾¾ |
| 192.168.0.208 | `redis://192.168.0.208:6379` | âŒ è¶…æ—¶ | - | Windowsä¸»æœºå±€åŸŸç½‘IPï¼Œé˜²ç«å¢™é˜»æ­¢ |

### 3.2 PowerShell Test-NetConnection éªŒè¯

```powershell
# localhost:6379
Test-NetConnection -ComputerName localhost -Port 6379
# ç»“æœ: TcpTestSucceeded: True, PingSucceeded: False (ICMPç¦ç”¨ï¼Œæ­£å¸¸)

# 127.0.0.1:6379
Test-NetConnection -ComputerName 127.0.0.1 -Port 6379
# ç»“æœ: TcpTestSucceeded: True

# 172.17.0.2:6379
Test-NetConnection -ComputerName 172.17.0.2 -Port 6379
# ç»“æœ: â±ï¸ è¶…æ—¶ (30såç»ˆæ­¢)
```

### 3.3 Node.js åŸç”ŸTCPæµ‹è¯•ç»“æœ

```
SUCCESS|localhost|localhost:6379|28ms
  Response: +PONG
SUCCESS|127.0.0.1|127.0.0.1:6379|2ms
  Response: +PONG
TIMEOUT|å®¹å™¨IP(172.17.0.2)|172.17.0.2:6379|5005ms
TIMEOUT|host.docker.internal|host.docker.internal:6379|5012ms
```

---

## 4. Windows Dockerç½‘ç»œæ¨¡å¼åˆ†æ

### 4.1 WSL2 vs Hyper-V åç«¯å¯¹æ¯”

| ç‰¹æ€§ | WSL2 (å½“å‰æ¨¡å¼) | Hyper-V |
|------|----------------|---------|
| æ¶æ„ | è½»é‡çº§VM + Linuxå†…æ ¸ | å®Œæ•´VM |
| å¯åŠ¨é€Ÿåº¦ | å¿« | è¾ƒæ…¢ |
| æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½ | è·¨OSè¾¹ç•Œè¾ƒæ…¢ | ä¸€è‡´ |
| **å®¹å™¨IPè®¿é—®** | **å®¿ä¸»æœºæ— æ³•ç›´æ¥è®¿é—®** | å®¿ä¸»æœºå¯è®¿é—® |
| localhostæ˜ å°„ | æ”¯æŒ | æ”¯æŒ |
| host.docker.internal | è§£æä½†ç«¯å£å¯èƒ½ä¸é€š | æ­£å¸¸å·¥ä½œ |
| ç½‘ç»œéš”ç¦» | å¼ºéš”ç¦» (vEthernet WSL) | æ¡¥æ¥æ¨¡å¼ |

### 4.2 WSL2ç½‘ç»œæ¶æ„è§£æ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Windows å®¿ä¸»æœº                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   åº”ç”¨ç¨‹åº      â”‚      â”‚    vEthernet (WSL)          â”‚   â”‚
â”‚  â”‚  (Node.jsç­‰)    â”‚      â”‚    172.20.32.1/20           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                              â”‚                   â”‚
â”‚           â”‚  localhost:6379 âœ…           â”‚ WSL2 NAT          â”‚
â”‚           â”‚  127.0.0.1:6379 âœ…           â”‚                   â”‚
â”‚           â”‚                              â–¼                   â”‚
â”‚           â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚           â”‚                     â”‚   WSL2 VM (Linux)   â”‚      â”‚
â”‚           â”‚                     â”‚  docker-desktop     â”‚      â”‚
â”‚           â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                                â”‚                  â”‚
â”‚           â”‚ âŒ 172.17.0.2:6379 (ä¸å¯è¾¾)    â”‚ Docker Bridge    â”‚
â”‚           â”‚ âŒ host.docker.internal (è¶…æ—¶) â”‚                  â”‚
â”‚           â”‚                                â–¼                  â”‚
â”‚           â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   hajimi-redis      â”‚      â”‚
â”‚                                  â”‚   172.17.0.2:6379   â”‚      â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 æ ¹å› åˆ†æ

1. **WSL2ç½‘ç»œéš”ç¦»**: WSL2ä½¿ç”¨è½»é‡çº§VMï¼Œå®¹å™¨è¿è¡Œåœ¨VMå†…éƒ¨çš„ç‹¬ç«‹ç½‘ç»œå‘½åç©ºé—´ä¸­ã€‚å®¹å™¨IP (172.17.0.x) æ˜¯VMå†…éƒ¨çš„ç§æœ‰ç½‘ç»œï¼ŒWindowså®¿ä¸»æœºæ— æ³•ç›´æ¥è·¯ç”±ã€‚

2. **host.docker.internal è¡Œä¸ºå·®å¼‚**:
   - **macOS**: host.docker.internal å¯ç›´æ¥è®¿é—®å®¿ä¸»æœºæœåŠ¡
   - **Linux**: host.docker.internal é€šå¸¸æŒ‡å‘docker0ç½‘æ¡¥IP
   - **Windows WSL2**: host.docker.internal è§£æä¸ºWindowsä¸»æœºçš„å±€åŸŸç½‘IP (192.168.0.208)ï¼Œä½†Windowsé˜²ç«å¢™é˜»æ­¢äº†æ¥è‡ªWSL2ç½‘ç»œçš„å…¥ç«™è¿æ¥

3. **ç«¯å£ç»‘å®šéªŒè¯**: 
   ```
   TCP    0.0.0.0:6379           0.0.0.0:0              LISTENING
   ```
   Redisæ­£ç¡®ç»‘å®šåˆ°æ‰€æœ‰æ¥å£ï¼Œä½†WSL2çš„NATåªè½¬å‘localhostæµé‡ã€‚

---

## 5. æ¨èé…ç½®

### 5.1 æ¨èè¿æ¥URL

| ä¼˜å…ˆçº§ | è¿æ¥URL | ä½¿ç”¨åœºæ™¯ |
|--------|---------|----------|
| ğŸ¥‡ é¦–é€‰ | `redis://127.0.0.1:6379` | Windowså®¿ä¸»æœºåº”ç”¨ç¨‹åº |
| ğŸ¥ˆ å¤‡é€‰ | `redis://localhost:6379` | éœ€è¦IPv6æ”¯æŒæ—¶ |
| âŒ é¿å… | `redis://172.17.0.2:6379` | WSL2ä¸‹ä¸å¯è¾¾ |
| âŒ é¿å… | `redis://host.docker.internal:6379` | Windows WSL2ä¸‹è¶…æ—¶ |

### 5.2 åº”ç”¨ç¨‹åºé…ç½®ç¤ºä¾‹

```javascript
// Node.js (ioredis æˆ– redis å®¢æˆ·ç«¯)
const redis = require('redis');

const client = redis.createClient({
  url: 'redis://127.0.0.1:6379',  // âœ… æ¨è
  socket: {
    connectTimeout: 5000,
    reconnectStrategy: (retries) => Math.min(retries * 50, 500)
  }
});

// é¿å… âŒ
// url: 'redis://172.17.0.2:6379'  // WSL2ä¸‹è¶…æ—¶
// url: 'redis://host.docker.internal:6379'  // Windowsä¸‹è¶…æ—¶
```

```python
# Python (redis-py)
import redis

r = redis.Redis(
    host='127.0.0.1',  # âœ… æ¨è
    port=6379,
    decode_responses=True,
    socket_connect_timeout=5
)
```

---

## 6. è‡ªæµ‹ç‚¹éªŒè¯

### âœ… NET-001: Docker Desktopç½‘ç»œæ¨¡å¼éªŒè¯

| æ£€æŸ¥é¡¹ | ç»“æœ | å¤‡æ³¨ |
|--------|------|------|
| WSL2æ¨¡å¼æ£€æµ‹ | âœ… é€šè¿‡ | `wsl -l -v` æ˜¾ç¤º docker-desktop Running Version 2 |
| å†…æ ¸ç‰ˆæœ¬ç¡®è®¤ | âœ… é€šè¿‡ | 6.6.87.2-microsoft-standard-WSL2 |
| è™šæ‹Ÿç½‘å¡å­˜åœ¨ | âœ… é€šè¿‡ | vEthernet (WSL Hyper-V firewall) 172.20.32.1 |

### âœ… NET-002: è¿é€šæ€§çŸ©é˜µéªŒè¯

| æµ‹è¯•é¡¹ | æœŸæœ›ç»“æœ | å®é™…ç»“æœ | çŠ¶æ€ |
|--------|----------|----------|------|
| localhost:6379 TCP | æˆåŠŸ | 28ms, +PONG | âœ… é€šè¿‡ |
| 127.0.0.1:6379 TCP | æˆåŠŸ | 2ms, +PONG | âœ… é€šè¿‡ |
| å®¹å™¨IP:6379 TCP | è¶…æ—¶ | 5005ms è¶…æ—¶ | âœ… ç¬¦åˆé¢„æœŸ(WSL2) |
| host.docker.internal TCP | è¶…æ—¶ | 5012ms è¶…æ—¶ | âœ… ç¬¦åˆé¢„æœŸ(Windows) |
| Docker exec ping | PONG | PONG | âœ… å®¹å™¨æ­£å¸¸è¿è¡Œ |

---

## 7. è§£å†³æ–¹æ¡ˆä¸æ›¿ä»£æ–¹æ¡ˆ

### 7.1 å½“å‰ç¯å¢ƒæœ€ä½³å®è·µ (WSL2)

1. **ä½¿ç”¨ localhost/127.0.0.1**: å”¯ä¸€å¯é çš„Windowsåˆ°å®¹å™¨è¿æ¥æ–¹å¼
2. **å®¹å™¨é—´é€šä¿¡**: ä½¿ç”¨å®¹å™¨å (å¦‚ `redis://hajimi-redis:6379`) åœ¨Dockerç½‘ç»œå†…é€šä¿¡
3. **å¼€å‘ç¯å¢ƒé…ç½®**:
   ```yaml
   # docker-compose.yml
   services:
     redis:
       image: redis:alpine
       ports:
         - "127.0.0.1:6379:6379"  # ä»…ç»‘å®šåˆ°localhost
   ```

### 7.2 å¦‚æœéœ€è¦è®¿é—®å®¹å™¨IP (å¯é€‰)

```powershell
# æ–¹æ¡ˆ1: ä½¿ç”¨ docker exec åœ¨å®¹å™¨å†…æ‰§è¡Œ
docker exec hajimi-redis redis-cli ping

# æ–¹æ¡ˆ2: åœ¨WSL2ä¸­è¿è¡Œåº”ç”¨ç¨‹åº (æ¨è)
# å°†Node.jsåº”ç”¨ç§»è‡³WSL2 Ubuntuç¯å¢ƒï¼Œå¯ç›´æ¥ä½¿ç”¨172.17.0.2

# æ–¹æ¡ˆ3: åˆ‡æ¢åˆ°Hyper-Våç«¯ (ä¸æ¨èï¼Œæ€§èƒ½è¾ƒå·®)
# Docker Desktopè®¾ç½® â†’ General â†’ Use the WSL 2 based engine (å–æ¶ˆå‹¾é€‰)
```

---

## 8. ç»“è®º

### è¯Šæ–­ç»“æœ
- **ç½‘ç»œæ¨¡å¼**: Docker Desktop WSL2åç«¯ âœ… æ­£å¸¸å·¥ä½œ
- **å®¹å™¨çŠ¶æ€**: hajimi-redis è¿è¡Œæ­£å¸¸ âœ…
- **ç«¯å£æ˜ å°„**: 0.0.0.0:6379 âœ… æ­£ç¡®é…ç½®
- **Windowsåˆ°å®¹å™¨è¿é€šæ€§**: âœ… localhost/127.0.0.1 æ­£å¸¸å·¥ä½œ

### æ ¹æœ¬åŸå› 
WSL2çš„æ¶æ„è®¾è®¡å°†Dockerå®¹å™¨ç½®äºè½»é‡çº§VMå†…éƒ¨ï¼ŒWindowså®¿ä¸»æœºåªèƒ½é€šè¿‡localhost/127.0.0.1è®¿é—®æ˜ å°„çš„å®¹å™¨ç«¯å£ï¼Œæ— æ³•ç›´æ¥è®¿é—®å®¹å™¨ç§æœ‰IPã€‚è¿™æ˜¯**é¢„æœŸè¡Œä¸º**ï¼Œä¸æ˜¯é…ç½®é”™è¯¯ã€‚

### æ¨èè¡ŒåŠ¨
1. âœ… ä½¿ç”¨ `redis://127.0.0.1:6379` ä½œä¸ºåº”ç”¨ç¨‹åºè¿æ¥URL
2. âŒ é¿å…ä½¿ç”¨ `redis://172.17.0.2:6379` æˆ– `redis://host.docker.internal:6379` åœ¨Windowså®¿ä¸»æœºç¯å¢ƒ
3. ğŸ“‹ æ›´æ–°é¡¹ç›®æ–‡æ¡£ï¼Œæ˜ç¡®Windows WSL2ç¯å¢ƒä¸‹çš„Redisè¿æ¥é…ç½®

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-14  
**è¯Šæ–­å·¥å…·**: PowerShell Test-NetConnection, Node.js netæ¨¡å—, Docker CLI  
**å‚è€ƒæ–‡æ¡£**: [Docker Desktop WSL2 backend](https://docs.docker.com/desktop/wsl/)
