# 风险与后续建议

> **文档版本**: v1.0.0  
> **关联工单**: HAJIMI-DEBT-CLEARANCE-001-LAZY-MVP  

---

## 1. 当前风险清单

### 1.1 高风险

#### R1: HNSW索引规模限制（单节点）

| 项目 | 描述 |
|------|------|
| **风险描述** | 当前Lazy-RAG使用单节点HNSW索引，超过10万向量时性能显著恶化 |
| **影响** | 无法支持大规模知识库（>10万文档） |
| **概率** | 高（业务增长必然触发） |

```
规模测试结果:
1,000向量   OK 0.8s  / 62MB  / 35ms
5,000向量   OK 1.5s  / 118MB / 68ms
10,000向量  OK 2.46s / 174MB / 92ms
50,000向量  WARN 8.2s  / 420MB / 156ms
100,000向量 FAIL 15.5s / 780MB / 245ms
```

**缓解措施**:
1. 监控向量数量，超过阈值告警
2. 实施数据归档策略
3. 考虑分片或云端方案

---

### 1.2 中风险

#### R2: P95延迟余量不足

| 项目 | 描述 |
|------|------|
| **风险描述** | 当前P95延迟92.45ms，距离100ms阈值仅7.55%余量 |
| **影响** | 负载波动时可能触发降级 |
| **概率** | 中（并发增加时触发） |

**缓解措施**:
1. 调整HNSW参数：efSearch从64降至48
2. 启用查询缓存
3. 限制并发数（推荐<=10）

#### R3: 量化精度波动

| 项目 | 描述 |
|------|------|
| **风险描述** | 动态量化依赖输入分布，极端输入可能导致精度下降 |
| **概率** | 中（边界情况） |

**缓解措施**:
1. 自动回退机制已实施
2. 持续监控INT8/FP32推理比例
3. 定期更新校准数据

---

## 2. 后续建议

### 2.1 短期建议（1-2周）

#### S1: 监控告警配置

**建议**: 配置关键指标监控

```yaml
alerts:
  - name: "HighP95Latency"
    condition: "p95_latency > 90ms"
    severity: warning
  - name: "MemoryLimitApproaching"
    condition: "memory_usage > 180MB"
    severity: warning
  - name: "VectorCountHigh"
    condition: "vector_count > 8000"
    severity: info
```

**优先级**: P0

#### S2: 查询缓存

**建议**: 为高频查询添加LRU缓存
- 预期效果: P95延迟 92ms -> 75ms
- 缓存命中率: ~30%

**优先级**: P1

---

### 2.2 中期建议（1-3月）

#### S3: Pinecone云迁移评估

**建议**: 评估Pinecone等云向量数据库

| 对比项 | 本地HNSW | Pinecone |
|--------|----------|----------|
| 规模上限 | 10万向量 | 无限 |
| 延迟 | <100ms | 50-150ms |
| 成本 | 0 | $0.10/1000 queries |
| 维护 | 高 | 低 |

**优先级**: P1

#### S4: 增量索引更新

**建议**: 支持文档增删改时的增量索引更新

**优先级**: P2

---

### 2.3 长期建议（3-6月）

#### S5: 知识图谱RAG增强

**建议**: 引入知识图谱增强检索质量
- 预期提升: 准确率 +5-10%

**优先级**: P3

#### S6: 边缘设备优化

**建议**: 优化ONNX模型支持边缘设备部署
- 模型剪枝
- 算子融合
- INT4量化

**优先级**: P3

---

## 3. 决策树

```
向量数量增长?
    |
    +-- 否 --> 保持现状，监控即可
    |
    +-- 是 --> 增长速度?
                  |
                  +-- 慢(<100/月) --> 数据归档策略
                  |
                  +-- 快(>100/月) --> 预算允许?
                                       |
                                       +-- 否 --> 多节点分片
                                       |
                                       +-- 是 --> Pinecone迁移
```

---

## 4. 技术债务跟踪

### 4.1 已清零债务 OK

| 债务项 | 清零日期 | 验证方式 |
|--------|----------|----------|
| SecondMe依赖 | 2026-02-17 | 全局搜索0引用 |
| FP32推理性能 | 2026-02-17 | 性能预算达成 |
| 架构文档缺失 | 2026-02-17 | 六件套交付 |

### 4.2 新增债务 WARN

| 债务项 | 严重程度 | 计划解决 |
|--------|----------|----------|
| 单节点规模限制 | 高 | S3/S5（1-3月） |
| 无实时索引更新 | 中 | S4（1-3月） |
| 监控不完善 | 低 | S1（1-2周） |

---

**文档结束**

> 风险管理是一个持续过程。建议每月 review 本清单。
