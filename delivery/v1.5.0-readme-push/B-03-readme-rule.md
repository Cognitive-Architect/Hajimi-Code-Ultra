# 第2章 Rule（规则篇）

## 2.1 核心概念定义

Hajimi-Unified 的运作建立在一套独特的世界观之上，这套世界观不仅定义了技术概念，更塑造了整个项目的文化氛围与协作范式。

### 2.1.1 术语表

| 术语 | 英文全称 | 定义 |
|------|----------|------|
| **Hajimi-Unified** | - | 单窗批处理架构理念，核心在于通过统一的界面窗口整合所有AI交互，实现高效的任务批量处理与上下文管理 |
| **LCR** | Luxury Context Runtime | 奢侈级上下文运行时，指项目在设计上不惜成本地保留完整对话历史与元数据，确保每次交互都拥有极致的上下文体验 |
| **七权人格** | The Seven Personas | 项目管理的人格化抽象，将七种关键职责拟人化为动漫角色，增强团队记忆与归属感 |
| **DEBT-XXX** | - | 债务编号规范，用于追踪技术债务与待办事项，格式为 `DEBT-三位数字` |
| **SPAWNER** | - | 饱和攻击模式，一种主动触发多次请求以提升成功率的策略 |
| **Ouroboros** | - | 自指架构设计，系统能够自我描述、自我检查、自我修复的元能力 |
| **额度** | Quota | 成本控制单元，用于度量API调用、计算资源等消耗，实现精细化的成本管理 |

### 2.1.2 七权人格映射表

七权人格是Hajimi-Unified项目管理的核心创新，将七种关键职责与动漫角色人格融合，形成独特的文化标识：

| 角色 | 代号 | 职责 | 对应lib目录 | 人格特征 |
|------|------|------|-------------|----------|
| **Soyorin** | PM | 项目管理 | `lib/pm/` | 全局统筹，制定计划，协调资源，是那个永远在操心项目进度的人 |
| **黄瓜睦** | Architect | 架构设计 | `lib/architect/` | 系统设计，结构规划，保持冷静与理性，是技术决策的守护者 |
| **唐音** | Engineer | 工程实现 | `lib/engineer/` | 编码实现，功能交付，充满行动力与解决问题的热情 |
| **咕咕嘎嘎** | QA | 质量保证 | `lib/qa/` | 测试验证，质量把控，以严谨态度守护代码品质 |
| **压力怪** | Audit | 审计合规 | `lib/audit/` | 代码审查，安全审计，以批判视角审视每一处细节 |
| **客服小祥** | Orchestrator | 协调编排 | `lib/orchestrator/` | 流程编排，服务协调，负责化解矛盾、疏通阻塞 |
| **奶龙娘** | Doctor | 故障诊断 | `lib/doctor/` | 故障排查，系统诊断，以治愈者的姿态修复问题 |

> 💡 **设计理念**：七权人格不仅是角色扮演，更是一种责任分配的可视化。当某个模块出现问题时，你可以直接说"去找黄瓜睦"（架构问题）或"让奶龙娘看看"（故障诊断），这种隐喻极大降低了沟通成本。

---

## 2.2 五层架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│  Layer 5: 人格层 (Persona Layer)                                     │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐
│  │Soyorin  │ │黄瓜睦   │ │唐音     │ │咕咕嘎嘎 │ │压力怪   │ │客服小祥 │ │奶龙娘   │
│  │  (PM)   │ │(Arch.)  │ │ (Eng)   │ │ (QA)    │ │ (Audit) │ │(Orch.)  │ │(Doctor) │
│  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘
├───────┴───────────┴───────────┴───────────┴───────────┴───────────┴───────────┤
│  Layer 4: 编排层 (Orchestration Layer)                               │
│  lib/orchestrator/ - 流程编排、服务协调、上下文管理                      │
├─────────────────────────────────────────────────────────────────────┤
│  Layer 3: 能力层 (Capability Layer)                                  │
│  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐          │
│  │   AI Provider   │ │   File Handler  │ │   Logger        │          │
│  │   接口适配       │ │   文件处理       │ │   日志系统       │          │
│  └─────────────────┘ └─────────────────┘ └─────────────────┘          │
├─────────────────────────────────────────────────────────────────────┤
│  Layer 2: 运行时层 (Runtime Layer) - LCR                             │
│  Luxury Context Runtime - 奢侈级上下文运行时                           │
│  - 完整对话历史保留                                                   │
│  - 元数据持久化                                                       │
│  - 多会话并行管理                                                      │
├─────────────────────────────────────────────────────────────────────┤
│  Layer 1: 基础设施层 (Infrastructure Layer)                          │
│  - Node.js 运行时                                                     │
│  - TypeScript 编译器                                                   │
│  - 外部API服务（OpenAI/Anthropic/等等）                                 │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2.1 架构层级说明

| 层级 | 名称 | 核心职责 | 关键特性 |
|------|------|----------|----------|
| L5 | 人格层 | 职责抽象与文化标识 | 七权人格映射，降低沟通成本 |
| L4 | 编排层 | 流程协调与资源调度 | 统一入口，状态管理 |
| L3 | 能力层 | 功能模块与外部适配 | 模块化设计，可扩展 |
| L2 | 运行时层 | 上下文管理与会话维护 | LCR奢侈级上下文体验 |
| L1 | 基础设施层 | 底层技术与外部服务 | 稳定可靠，高性能 |

---

## 2.3 命名规则

### 2.3.1 债务编号规范 DEBT-XXX

技术债务与待办事项采用统一的编号规范：

```
格式：DEBT-<三位数字>
示例：DEBT-001, DEBT-042, DEBT-997
```

#### 债务分级定义

| 级别 | 含义 | 处理时限 | 说明 |
|------|------|----------|------|
| **P0** | 当前版本阻塞 | 立即处理 | 阻塞当前版本发布，必须在本版本解决 |
| **P1** | 下一版本规划 | 下版本前 | 非阻塞但重要，需在下一版本规划中处理 |
| **P2** | 待定/观察 | 视情况 | 记录跟踪，待需求明确或资源充裕时处理 |

#### 债务状态流转

```
[Open] → [In Progress] → [Resolved]
   ↓           ↓
[Duplicate] [Won't Fix]
```

### 2.3.2 文件命名规范

```
工单文档：  B-XX-<name>-<type>.md       (e.g., B-03-readme-rule.md)
白皮书：    HAJIMI-vX.X.X-白皮书-vX.X.md
自测表：    HAJIMI-XXX-自测表-vX.X.md
债务文档：  DEBT-XXX-描述.md
```

---

## 2.4 第一性原理

### 2.4.1 无失败原则

> **ID-97**: "无失败原则" —— 在Hajimi-Unified的设计理念中，不存在"失败"的概念，只存在"尚未成功"的状态。每一次非预期的结果都是系统学习的机会，每一个异常都是改进的契机。

这一原则贯穿于项目的方方面面：

| 场景 | 传统视角 | Hajimi视角 |
|------|----------|------------|
| API调用超时 | 失败，需重试 | 收集超时数据，优化策略 |
| 测试不通过 | 失败，需修复 | 系统自检，定位根因 |
| 架构缺陷 | 失败，需重构 | 债务记录，渐进式改进 |

### 2.4.2 原则衍生

基于"无失败原则"，项目发展出以下实践准则：

1. **饱和攻击（SPAWNER）**：不依赖单次请求的成功，通过多路并行提升整体成功率
2. **债务驱动（DEBT-Driven）**：将技术问题显性化为可追踪的债务，而非隐性的隐患
3. **自愈设计（Ouroboros）**：系统具备自我诊断与自我修复的元能力
4. **奢侈上下文（LCR）**：不惜成本保留完整上下文，为后续分析提供可能

---

## 2.5 本章自检清单

- [README-007] 含七权人格映射表 ✓
- [README-008] 含债务编号规范DEBT-XXX ✓
- [README-009] 含"无失败原则"直接引用 ✓

---

> "规则不是束缚，而是自由的基础。" —— 黄瓜睦
