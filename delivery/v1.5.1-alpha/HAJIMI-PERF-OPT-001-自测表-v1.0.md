# HAJIMI-PERF-OPT-001 性能优化自测表 v1.0

**文档版本**: v1.0  
**创建日期**: 2026-02-17  
**关联任务**: HAJIMI-PERF-OPT-001 (B-01/03, B-02/03, B-03/03)  
**测试目标**: 查询缓存、HNSW调优、分片架构性能验证

---

## 1. CACHE-001 ~ CACHE-003（查询缓存）

### CACHE-001：命中率>25%（热点查询场景）
- **测试方法**: 1000次查询，其中200次重复热点查询
- **通过标准**: hitRate >= 0.25
- **测试命令**: `npm test -- query-cache.test.ts -t "hit-rate"`
- **状态**: ☐ 未测试 / ☐ 通过 / ☐ 失败

### CACHE-002：P95降低>10ms（对比无缓存）
- **测试方法**: 对比启用缓存前后的P95延迟
- **通过标准**: deltaP95 >= 10ms
- **测试命令**: `npm test -- query-cache.test.ts -t "latency-improvement"`
- **状态**: ☐ 未测试 / ☐ 通过 / ☐ 失败

### CACHE-003：内存<50MB（1000条缓存满载）
- **测试方法**: 满载1000条缓存，监测内存占用
- **通过标准**: memoryUsage <= 52428800 bytes (50MB)
- **测试命令**: `npm test -- query-cache.test.ts -t "memory-budget"`
- **状态**: ☐ 未测试 / ☐ 通过 / ☐ 失败

---

## 2. HNSW-001 ~ HNSW-003（HNSW调优）

### HNSW-001：P95<80ms（10K向量负载）
- **测试方法**: 10K向量，100次查询，测量P95
- **通过标准**: p95Latency < 80ms
- **测试命令**: `npx ts-node scripts/benchmark-hnsw-params.ts`
- **状态**: ☐ 未测试 / ☐ 通过 / ☐ 失败

### HNSW-002：召回率≥85%（对比Ground Truth）
- **测试方法**: Brute Force vs HNSW Top-5结果对比
- **通过标准**: recallRate >= 0.85
- **测试命令**: `npx ts-node scripts/benchmark-hnsw-params.ts --recall`
- **状态**: ☐ 未测试 / ☐ 通过 / ☐ 失败

### HNSW-003：内存<160MB（10K向量）
- **测试方法**: 加载10K向量，监测内存占用
- **通过标准**: memoryUsage < 163840000 bytes (160MB)
- **测试命令**: `npx ts-node scripts/benchmark-hnsw-params.ts --memory`
- **状态**: ☐ 未测试 / ☐ 通过 / ☐ 失败

---

## 3. SHARD-001 ~ SHARD-003（分片架构）

### SHARD-001：分片架构可扩展（支持1-10个分片）
- **测试方法**: 验证架构支持动态增减分片
- **通过标准**: 支持1-10个分片配置
- **测试方法**: 代码审查 + 架构评审
- **状态**: ☐ 未测试 / ☐ 通过 / ☐ 失败

### SHARD-002：查询聚合正确（结果合并准确）
- **测试方法**: 多分片查询，验证合并结果正确性
- **通过标准**: 合并结果与单分片全量查询一致
- **测试方法**: 单元测试 + 集成测试
- **状态**: ☐ 未测试 / ☐ 通过 / ☐ 失败

### SHARD-003：50万向量P95<150ms（理论值）
- **测试方法**: 理论分析 + 小规模验证
- **通过标准**: projectedP95 < 150ms
- **备注**: 需生产环境大规模验证
- **状态**: ☐ 未测试 / ☐ 通过 / ☐ 失败 / ⏳ 理论值

---

## 4. 质量门禁检查

### GATE-001：TypeScript严格模式零错误
- **检查命令**: `npx tsc --noEmit`
- **通过标准**: 0 errors
- **状态**: ☐ 未检查 / ☐ 通过 / ☐ 失败

### GATE-002：原27项自测保持全绿
- **检查方法**: `npm test`（全部测试）
- **通过标准**: 27/27 passed
- **状态**: ☐ 未检查 / ☐ 通过 / ☐ 失败

### GATE-003：P95叠加效果<80ms
- **检查方法**: 缓存+HNSW调优联合测试
- **通过标准**: combinedP95 < 80ms (目标75ms)
- **状态**: ☐ 未检查 / ☐ 通过 / ☐ 失败

---

## 5. 汇总表

| 类别 | 自测项 | 状态 | 备注 |
|:-----|:-------|:----:|:-----|
| 缓存 | CACHE-001 | ⏳ | 待验证 |
| 缓存 | CACHE-002 | ⏳ | 待验证 |
| 缓存 | CACHE-003 | ⏳ | 待验证 |
| HNSW | HNSW-001 | ⏳ | 待验证 |
| HNSW | HNSW-002 | ⏳ | 待验证 |
| HNSW | HNSW-003 | ⏳ | 待验证 |
| 分片 | SHARD-001 | ⏳ | 待验证 |
| 分片 | SHARD-002 | ⏳ | 待验证 |
| 分片 | SHARD-003 | ⏳ | 理论值 |
| 门禁 | GATE-001 | ⏳ | 待检查 |
| 门禁 | GATE-002 | ⏳ | 待检查 |
| 门禁 | GATE-003 | ⏳ | 待验证 |

---

## 6. 测试执行记录

| 日期 | 执行人 | 环境 | 结果摘要 |
|:-----|:-------|:-----|:---------|
|      |        |      |          |
|      |        |      |          |

---

## 7. 结论

**最终状态**: ⏳ 待测试

**说明**: 本自测表需在完成 B-01/03（查询缓存）、B-02/03（HNSW调优）、B-03/03（分片架构）三项开发任务后执行。

---

*文档结束*
